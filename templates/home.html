{% load static %}
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Trend Maxi — 트렌드 & 포럼</title>

  {# 기본 메타 #}
  <link rel="canonical" href="{{ request.build_absolute_uri }}">
  <meta name="robots" content="index,follow">
  <meta name="author" content="Trend Maxi">
  <meta name="description" content="Trend Maxi — 트렌드, 포럼, 시그널을 한곳에서.">

  {# Open Graph #}
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Trend Maxi">
  <meta property="og:title" content="Trend Maxi — 트렌드 & 포럼">
  <meta property="og:description" content="트렌드, 포럼, 시그널을 한곳에서.">
  <meta property="og:url" content="{{ request.build_absolute_uri }}">
  <meta property="og:image" content="{% static 'img/og-cover.png' %}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  {# Twitter #}
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Trend Maxi — 트렌드 & 포럼">
  <meta name="twitter:description" content="트렌드, 포럼, 시그널을 한곳에서.">
  <meta name="twitter:image" content="{% static 'img/twitter-card.png' %}">

  {# Favicons #}
  <link rel="icon" href="{% static 'img/favicon.ico' %}">
  <link rel="icon" type="image/png" sizes="48x48" href="{% static 'img/favicon-48x48.png' %}">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon-32x32.png' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon-16x16.png' %}">
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/apple-touch-icon.png' %}">
  <link rel="manifest" href="{% static 'img/site.webmanifest' %}" crossorigin="use-credentials" disabled>

  {# JSON-LD #}
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"Trend Maxi",
    "url":"{{ request.build_absolute_uri }}",
    "logo":"{% static 'img/logo-square-1024.png' %}"
  }
  </script>
  <style>
    :root{ --brand:#6b5cff; --ink:#0f172a; --muted:#64748b; --line:#e2e8f0; --card:#fff; --chip:#f8fafc; --bg:#f6f7fb; --shadow:0 10px 30px rgba(15,23,42,.06); }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:24px 16px}

    .header{display:flex;align-items:center;justify-content:space-between;margin:10px 0 18px}
    .logo{font-weight:900;letter-spacing:.2px}
    .logo a{color:var(--brand)}
    .tabs{display:flex;gap:10px;flex-wrap:wrap;background:#fff;border:1px solid var(--line);
      border-radius:12px;padding:6px; box-shadow:var(--shadow);}
    .tab{padding:10px 14px;border-radius:10px;color:#1f2937;border:1px solid transparent;background:transparent;font-weight:700}
    .tab:hover{background:var(--chip)}
    .tab.active{background:rgba(107,92,255,.08);color:var(--brand);border-color:rgba(107,92,255,.25)}

    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:18px;box-shadow:var(--shadow)}
    .board-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .board-title{margin:0;font-size:18px;font-weight:800}
    .list{display:flex; flex-direction:column}
    .row{
      display:grid;
      grid-template-columns: 1fr auto;   /* 좌:가변, 우:고정 */
      grid-template-rows: auto auto;     /* 1행 제목, 2행 서브메타 */
      gap:6px 10px;
      padding:12px 10px;
      border-top:1px solid var(--line);
      align-items:center;
    }
    .row:first-child{border-top:none}

    /* 1행 */
    .title{
      grid-column: 1 / -1;               /* 1행 전체 너비 */
      display:flex; align-items:center; gap:8px; min-width:0;
    }
    .title a{font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .title .badge{font-size:11px; padding:4px 8px; border-radius:999px; background:#eef2ff; color:#4f46e5; font-weight:700}

    /* 좋아요를 오른쪽 끝으로 밀기 */
    .like-count{ margin-left:auto; font-size:13px; color:#475569; }

    /* 2행: 작성자(좌), 날짜(우) — 작게/연한색 */
    .author{
      grid-column: 1; color:#0f172a; font-weight:600; font-size:12px; text-align:left;
    }
    .meta{
      grid-column: 2; color:var(--muted); font-size:12px; text-align:right;
    }

    /* 모바일에서 간격 살짝 여유 */
    @media (max-width:900px){
      .row{gap:4px 8px; padding:12px 8px}
    }

    .pagination{display:flex;gap:6px;justify-content:center;margin-top:16px;flex-wrap:wrap}
    .page-btn{min-width:36px;height:36px;display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--line);border-radius:10px;background:#fff;padding:0 10px;}
    .page-btn:hover{border-color:#cbd5e1}
    .page-btn.active{border-color:var(--brand); color:var(--brand); font-weight:800; background:#f5f7ff}
    .page-btn[aria-disabled="true"]{opacity:.45;pointer-events:none}

    .stat{
      display:inline-flex; align-items:center; gap:6px;
      padding:2px 8px; border-radius:999px;
      font-size:12px; color:#475569; background:#eef2ff; border:1px solid #e2e8f0;
      margin-left:6px;
    }
    .submeta{
      grid-column: 1 / -1;        /* 2행 레이아웃을 쓰는 경우 전체폭 차지 */
      color:#64748b; font-size:12px; margin-top:2px;
      display:flex; align-items:center; gap:6px;
    }
    .submeta .dot{ opacity:.6; }


    @media (max-width:900px){ .row{grid-template-columns:1fr 86px 82px} .tabs{gap:6px} }
  </style>
</head>
<body>
  <main class="container">

    <!-- Header / Tabs -->
    <div class="header">
      <div class="logo"><a href="?tab={{ active_tab|default:'fortune' }}">Trend Maxi</a></div>
      <nav class="tabs" role="tablist" aria-label="Boards">
        <a class="tab {% if active_tab == 'free' %}active{% endif %}" href="?tab=free" role="tab" aria-selected="{% if active_tab == 'free' %}true{% else %}false{% endif %}">자유게시판</a>
        <a class="tab {% if active_tab == 'fortune' or not active_tab %}active{% endif %}" href="?tab=fortune" role="tab" aria-selected="{% if active_tab == 'fortune' or not active_tab %}true{% else %}false{% endif %}">오늘의 운세</a>
      </nav>
    </div>

    <!-- ===== Fortune Board ===== -->
    {% if active_tab == 'fortune' or not active_tab %}
    <section class="card" id="board-fortune">
      <div class="board-head">
        <h3 class="board-title">오늘의 운세</h3>
      </div>
      <div class="list">
        {% for p in page_obj_fortune %}
          <div class="row">
            <div class="title">
              {% if p.is_hot %}<span class="badge">HOT🔥</span>{% endif %}
              <a href="{{ p.get_absolute_url }}">{{ p.title }}</a>
              {% if p.admin_category %}<span class="meta" style="margin-left:6px">#{{ p.admin_category }}</span>{% endif %}

              <span class="stat">♥ {{ p.like_count }}</span>
            </div>


            <!-- 기존: <div class="author">...</div><div class="meta">...</div> 를 교체 -->
            <div class="submeta">
              <span class="author">{{ p.author_display }}</span>
              <span class="dot">•</span>
              <span class="date">{{ p.created_at|date:"Y-m-d H:i" }}</span>
            </div>

          </div>
        {% empty %}
          <div class="row"><div class="title"><span class="meta">작성된 글이 없습니다.</span></div><div></div><div></div></div>
        {% endfor %}
      </div>

      {% with page=page_obj_fortune tab='fortune' %}
      <nav class="pagination" aria-label="fortune pagination">
        <a class="page-btn" {% if page.number > 1 %}href="?tab={{ tab }}&page=1"{% else %}href="#" aria-disabled="true"{% endif %}>«</a>
        <a class="page-btn" {% if page.has_previous %}href="?tab={{ tab }}&page={{ page.previous_page_number }}"{% else %}href="#" aria-disabled="true"{% endif %}>‹</a>
        {% for num in page.paginator.page_range %}
          {% if num >= page.number|add:"-2" and num <= page.number|add:"2" %}
          <a class="page-btn {% if page.number == num %}active{% endif %}" href="?tab={{ tab }}&page={{ num }}">{{ num }}</a>
          {% endif %}
        {% endfor %}
        <a class="page-btn" {% if page.has_next %}href="?tab={{ tab }}&page={{ page.next_page_number }}"{% else %}href="#" aria-disabled="true"{% endif %}>›</a>
        <a class="page-btn" {% if page.number < page.paginator.num_pages %}href="?tab={{ tab }}&page={{ page.paginator.num_pages }}"{% else %}href="#" aria-disabled="true"{% endif %}>»</a>
      </nav>
      {% endwith %}
    </section>
    {% endif %}

    <!-- ===== Free Board ===== -->
    {% if active_tab == 'free' %}
    <section class="card" id="board-free">
      <div class="board-head">
        <h3 class="board-title">자유게시판</h3>
      </div>
      <div class="list">
        {% for p in page_obj_free %}
          <div class="row">
            <div class="title">
              {% if p.is_hot %}<span class="badge">HOT🔥</span>{% endif %}
              <a href="{{ p.get_absolute_url }}">{{ p.title }}</a>
              {% if p.admin_category %}<span class="meta" style="margin-left:6px">#{{ p.admin_category }}</span>{% endif %}

              <span class="stat">♥ {{ p.like_count }}</span>
              <span class="stat">💬 {{ p.comment_count }}</span>  <!-- 추가 -->
            </div>


            <!-- 기존: <div class="author">...</div><div class="meta">...</div> 를 교체 -->
            <div class="submeta">
              <span class="author">{{ p.author_display }}</span>
              <span class="dot">•</span>
              <span class="date">{{ p.created_at|date:"Y-m-d H:i" }}</span>
            </div>

          </div>
        {% empty %}
          <div class="row"><div class="title"><span class="meta">작성된 글이 없습니다.</span></div><div></div><div></div></div>
        {% endfor %}
      </div>

      {% with page=page_obj_free tab='free' %}
      <nav class="pagination" aria-label="free pagination">
        <a class="page-btn" {% if page.number > 1 %}href="?tab={{ tab }}&page=1"{% else %}href="#" aria-disabled="true"{% endif %}>«</a>
        <a class="page-btn" {% if page.has_previous %}href="?tab={{ tab }}&page={{ page.previous_page_number }}"{% else %}href="#" aria-disabled="true"{% endif %}>‹</a>
        {% for num in page.paginator.page_range %}
          {% if num >= page.number|add:"-2" and num <= page.number|add:"2" %}
          <a class="page-btn {% if page.number == num %}active{% endif %}" href="?tab={{ tab }}&page={{ num }}">{{ num }}</a>
          {% endif %}
        {% endfor %}
        <a class="page-btn" {% if page.has_next %}href="?tab={{ tab }}&page={{ page.next_page_number }}"{% else %}href="#" aria-disabled="true"{% endif %}>›</a>
        <a class="page-btn" {% if page.number < page.paginator.num_pages %}href="?tab={{ tab }}&page={{ page.paginator.num_pages }}"{% else %}href="#" aria-disabled="true"{% endif %}>»</a>
      </nav>
      {% endwith %}
    </section>
    {% endif %}

  </main>
</body>
</html>
